# Linux用户和用户组管理

- 用户账号的添加和删除和修改
- 用户口令的管理
- 用户组的管理

---

## 账户管理

### 添加用户

```
useradd 参数 用户名
# 参数表
-c comment 指定一段注释性描述。
-d 目录 指定用户主目录，如果此目录不存在，则同时使用-m选项，可以创建主目录。
-g 用户组 指定用户所属的用户组。
-G 用户组，用户组 指定用户所属的附加组。
-s Shell文件 指定用户的登录Shell。
-u 用户号 指定用户的用户号，如果同时有-o选项，则可以重复使用其他用户的标识号。
```

### 删除用户

```
userdel 参数 用户名
# 参数名
-r 把用户的主目录删除（以及/etc/passwd, /etc/shadow, /etc/group)
```

### 修改用户

```
usermod 参数 用户名
# 参数
-c, -d, -m, -g, -G, -s, -u, -o与useradd一样
-l  新用户名
```

## 用户命令管理

```
passwd 参数 用户名
# 参数
-l 锁定口令，即禁用账号。
-u 口令解锁。
-d 使账号无口令。
-f 强迫用户下次登录时修改口令。
```

## 用户组管理

```
groupadd 参数 组名
# 参数
-g GID 指定新用户组的组标识号（GID）。
-o 一般与-g选项同时使用，表示新用户组的GID可以与系统已有用户组的GID相同。
```

```
# 删除用户组
groupdel 组名
```

```
groupmod 参数 组名
# 参数
-g GID 为用户组指定新的组标识号。
-o 与-g选项同时使用，用户组的新GID可以与系统已有用户组的GID相同。
-n 新用户组 将用户组的名字改为新名字
```

```
# 用户切换用户组
newgrp 组名
```

## 用户管理相关系统文件

以上主要是对`/etc/paaswd`,`/etc/shadow`,`/etc/group`文件的修改

1. `/etc/passwd`

```
用户名:口令:用户标识号:组标识号:注释性描述:主目录:登录Shell
# 示例
pomelo:x:1000:1000:,,,:/home/pomelo:/bin/bash
```

- 口令用`x`表示是因为被加密储存在`/etc/shadow`中
- 用户标识号从0~65535，0是root标识符，1~99由系统保留作为管理账号
- 组标识符对应`/etc/group`中的记录
- 伪用户的存在是为了方便系统管理，登录shell为`/usr/sbin/nologin`，就是没有

2. `/etc/shadow`

```
登录名:加密口令:最后一次修改时间:最小时间间隔:最大时间间隔:警告时间:不活动时间:失效时间:标志
```

- "口令"字段存放的是加密后的用户口令字，长度为13个字符。如果含有不属于集合 { ./0-9A-Za-z  }中的字符，则对应的用户不能登录。
- "最后一次修改时间"表示的是从某个时刻起，到用户最后一次修改口令时的天数。起点是1970年1月1日
- "最小时间间隔"指的是两次修改口令之间所需的最小天数。
- "最大时间间隔"指的是口令保持有效的最大天数。
- "警告时间"字段表示的是从系统开始警告用户到用户密码正式失效之间的天数。
- "不活动时间"表示的是用户没有登录活动但账号仍能保持有效的最大天数。
- "失效时间"字段给出的是一个绝对的天数，如果使用了这个字段，那么就给出相应账号的生存期。期满后，该账号就不再是一个合法的账号，也就不能再用来登录了。

3. `/etc/group`

```
组名:口令:组标识号:组内用户列表
```

## 批量添加用户

1. 编辑文本用户文件`user.txt`，按照`/etc/passwd`格式
2. 以root执行`newusers < user.txt`
3. 执行命令`pwunconv`
4. 编辑密码文件`passwd.txt`，格式为`用户名:密码`
5. 以root执行`chpasswd < passwd.txt`
6. 确认密码写入`/etc/passwd`后执行命令`pwconv`

